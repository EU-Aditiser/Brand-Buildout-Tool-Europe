<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Security policies compatible with Google Sign-In -->
    <meta http-equiv="Cross-Origin-Opener-Policy" content="unsafe-none">
    <meta http-equiv="Cross-Origin-Embedder-Policy" content="unsafe-none">
    <meta http-equiv="Cross-Origin-Resource-Policy" content="cross-origin">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https: data: 'unsafe-inline' 'unsafe-eval'; connect-src 'self' https:; img-src 'self' https: data:; frame-src 'self' https:; script-src 'self' https://accounts.google.com https://apis.google.com https://cdn.jsdelivr.net 'unsafe-inline' 'unsafe-eval'; style-src 'self' https: 'unsafe-inline'; font-src 'self' https: data:;">
    <title>EU Aditiser</title>
    <!-- Preload Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    <link rel="stylesheet" href="index.css">
    <style>
      /* Fallback font stack in case Google Fonts fails to load */
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
      }
    </style>
    <!-- Add debugging script -->
    <script>
      window.addEventListener('error', function(e) {
        console.log('Global error:', e.message, 'at', e.filename, ':', e.lineno);
      });
    </script>
  </head>
  <body>
    <div class="container">
      <header class="navbar">
        <div class="container">
          <a class="navbar-brand" href="#">
            <img src="logo.png" alt="">
          </a>
        </div>
      </header>

      <h4>Aditiser Account Login</h4>
      <!--Add buttons to initiate auth sequence-->
      <div id="g_id_signin" 
           data-client_id="584505830851-0k3n478q7ecobi5k97o460c4dqoj8jf5.apps.googleusercontent.com"
           data-context="signin"
           data-ux_mode="popup"
           data-callback="handleCredentialResponse"
           data-auto_prompt="false"
           data-itp_support="true">
      </div>
      <div id="signin-error" style="color: red; display: none; margin-top: 10px;"></div>

      <h3>Brand Buildout Quickstart Template Tool</h3>
      <div class="input-group">
        <span class="input-group-text" id="campaign-addon" for="campaign_name">Campaign:</span>
        <input type="text" class="form-control" id="campaign_name" name="campaign_name" aria-describedby="campaign-addon">
      </div><br>
      <div class="input-group">
        <span class="input-group-text" id="adgroup-addon">Ad Group:</span>
        <input type="text" class="form-control" id="ad_group_name" name="ad_group_name" aria-describedby="adgroup-addon"><br>
      </div><br>
      <div class="input-group">
        <span class="input-group-text" id="keyword-addon">Base Keyword:</span>
        <input type="text" class="form-control" id="base_keyword_name" name="base_keyword_name" aria-describedby="keyword-addon"><br>
      </div><br>
      <div class="input-group">
        <span class="input-group-text" id="finalurl-addon">Final URL:</span>
        <input type="text" class="form-control" id="final_url_name" name="final_url_name" aria-describedby="finalurl-addon"><br>
      </div><br>
      <button type="button" class="btn btn-primary" id="create_brand_buildout_template_button">Create</button><br><br>

      <h3>European Brand Buildout Generator</h3>
      <div class="input-group">
        <span class="input-group-text" id="keyword-spreadsheet-addon">Keyword Spreadsheet URL:</span>
        <input class="form-control" type="text" id="master_brand_buildout_spreadsheet" name="master_brand_buildout_spreadsheet" value="">
      </div><br>
      <div class="input-group">
        <span class="input-group-text" id="account-data-spreadsheet-addon">Manager Data Spreadsheet URL:</span>
        <input class="form-control" type="text" id="account_data_spreadsheet" name="account_data_spreadsheet" value="">
      </div><br>

      <div id="accounts_form"></div>
      
      <button type="button" class="btn btn-primary mt-3" id="create_account_buildout_button">
        <span id="buildout_button">
          
        </span>
      </button>
      <br><br>

      <h4>Patch Notes</h4>
      <p id="patch_notes">

      </p>
      <footer class="navbar">Current Version: v0.2.0 </footer>
    </div>
    <!--Stylesheet-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    <link rel="stylesheet" href="index.css">
    <!--Scripts-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>
    
    <!-- Load Google API scripts first -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <!-- Then load application scripts -->
    <script src="constants.js"></script>
    <script src="spreadsheets.js"></script>
    <script src="index.js"></script>

    <!-- Robust Google Sign-In script loading -->
    <script>
      function showSignInError(msg) {
        var el = document.getElementById('signin-error');
        if (el) {
          el.textContent = msg;
          el.style.display = 'block';
        }
      }
      function loadGsiScript(callback) {
        var script = document.createElement('script');
        script.src = 'https://accounts.google.com/gsi/client';
        script.async = true;
        script.defer = true;
        script.onload = callback;
        script.onerror = function() {
          showSignInError('Failed to load Google Sign-In. Please check your connection or disable ad blockers.');
        };
        document.head.appendChild(script);
      }
      function initGoogleSignIn() {
        if (window.google && google.accounts && google.accounts.id) {
          google.accounts.id.initialize({
            client_id: '584505830851-0k3n478q7ecobi5k97o460c4dqoj8jf5.apps.googleusercontent.com',
            callback: handleCredentialResponse,
            auto_select: false,
            cancel_on_tap_outside: false,
            context: 'signin',
            ux_mode: 'popup',
            itp_support: true
          });
          google.accounts.id.renderButton(
            document.getElementById('g_id_signin'),
            {
              theme: 'outline',
              size: 'large',
              type: 'standard',
              text: 'signin_with',
              shape: 'rectangular',
              width: 250,
              logo_alignment: 'left'
            }
          );
        } else {
          showSignInError('Google Sign-In not loaded properly. Please refresh the page or try a different browser.');
        }
      }
      document.addEventListener('DOMContentLoaded', function() {
        loadGsiScript(function() {
          setTimeout(initGoogleSignIn, 100); // slight delay to ensure script is ready
        });
      });
    </script>
  </body>
</html>